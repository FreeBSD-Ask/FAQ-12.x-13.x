# 8.3. 哪些分区可以安全地使用软更新？我听说/上的软更新会导致问题。那么，日志式软更新呢？

简短的回答。软更新通常可以在所有分区上安全使用。

长答案。软更新有两个特点，在某些分区上可能是不可取的。首先，一个软更新分区在系统崩溃时有很小的机会丢失数据。分区不会被破坏，因为数据只是丢失。第二，"软更新" 可能导致暂时的空间不足。

当使用软更新时，内核可能需要长达 30 秒的时间来将变化写入物理磁盘。当一个大文件被删除时，该文件仍然停留在磁盘上，直到内核真正执行删除。这可能导致一个非常简单的竞赛条件。假设一个大文件被删除，另一个大文件被立即创建。第一个大文件还没有真正从物理磁盘上删除，所以磁盘可能没有足够的空间给第二个大文件。这将产生一个错误，即分区没有足够的空间，尽管有一大块空间刚刚被释放。几秒钟后，文件创建如期进行。

如果一个系统在内核接受一个数据块写入磁盘后，但在该数据实际被写出之前崩溃，数据可能会丢失。这种风险是非常小的，但通常是可以控制的。

这些问题影响到所有使用软更新的分区。那么，这对根分区意味着什么？

根分区上的重要信息很少变化。如果系统在做出这种改变后的 30 秒内崩溃，有可能会丢失数据。这种风险对于大多数应用程序来说是可以忽略不计的，但要注意它的存在。如果系统不能容忍这么大的风险，就不要在根文件系统上使用软更新!

**/** 传统上是最小的分区之一。如果 **/tmp** 在 **/** 上，可能会出现间歇性的空间问题。将 **/tmp** 连接到 **/var/tmp** 会解决这个问题。

最后，[dump(8)](https://www.freebsd.org/cgi/man.cgi?query=dump&sektion=8&format=html)在文件系统的实时模式(-L)下不工作，使用Journaled Soft Updates（SU+J）。
