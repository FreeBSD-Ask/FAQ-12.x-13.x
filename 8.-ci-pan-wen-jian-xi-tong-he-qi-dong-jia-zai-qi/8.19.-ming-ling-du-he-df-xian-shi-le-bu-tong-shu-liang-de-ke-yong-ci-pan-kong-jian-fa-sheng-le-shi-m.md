# 8.19.  命令 du 和 df 显示了不同数量的可用磁盘空间。发生了什么事？

这是由这些命令的实际工作方式决定的。`du` 穿过目录树，测量每个文件有多大，并显示总数。`df` 只是询问文件系统还剩下多少空间。它们似乎是同一件事，但是一个没有目录项的文件会影响到 `df`，而不是 `du`。

当一个程序正在使用一个文件，而该文件被删除时，该文件并没有真正从文件系统中删除，直到该程序停止使用它。然而，该文件会立即从目录列表中删除。作为一个例子，考虑一个大到足以影响 `du` 和 `df` 输出的文件。一个正在用 `more` 查看的文件可以被删除而不会引起错误。该条目被从目录中删除，因此没有其他程序或用户可以访问它。然而，`du` 显示它已经消失了，因为它已经走过了目录树，文件没有被列出。`df` 显示它仍然存在，因为文件系统知道 `more` 仍然在使用该空间。一旦 `more` 会话结束，`du` 和 `df` 将同意。

这种情况在网络服务器上很常见。许多人建立了一个 FreeBSD 网络服务器，却忘记了轮换日志文件。访问日志填满了 **/var**。新的管理员删除了该文件，但系统仍然抱怨说该分区已满。停止并重启网络服务器程序会释放该文件，让系统释放磁盘空间。为了防止这种情况发生，可以设置[newsyslog(8)](https://www.freebsd.org/cgi/man.cgi?query=newsyslog&sektion=8&format=html)。

请注意，"软更新 "可能会延迟释放磁盘空间，而且可能需要 30 秒的时间才能看到变化。
